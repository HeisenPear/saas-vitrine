---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import ScrollReveal from '../../components/react/ScrollReveal';
import { Calendar, Clock, Tag, ArrowRight } from 'lucide-react';

const blogPosts = (await getCollection('blog')).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

const categories = [...new Set(blogPosts.map((post) => post.data.category))];
---

<Layout
  title="Blog - Conseils SEO & Création Web | Renaissance"
  description="Découvrez nos articles sur le SEO local, la création de sites web et le marketing digital pour artisans et PME."
>
  <!-- Hero Section -->
  <section class="py-20 bg-gradient-to-br from-dark-900 via-dark-800 to-dark-900 relative overflow-hidden">
    <div class="absolute inset-0 opacity-20">
      <div class="absolute top-1/4 right-1/4 w-96 h-96 bg-primary-500/20 rounded-full blur-3xl"></div>
      <div class="absolute bottom-1/4 left-1/4 w-96 h-96 bg-accent/20 rounded-full blur-3xl"></div>
    </div>

    <div class="relative container mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <ScrollReveal client:load>
        <h1 class="text-fluid-5xl font-heading font-bold text-white mb-6">
          Blog <span class="text-gradient">Renaissance</span>
        </h1>
      </ScrollReveal>
      <ScrollReveal client:load delay={0.2}>
        <p class="text-fluid-xl text-gray-300 max-w-3xl mx-auto">
          Conseils, tutoriels et stratégies pour booster votre visibilité en ligne
        </p>
      </ScrollReveal>
    </div>
  </section>

  <!-- Blog Grid -->
  <section class="py-24">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="max-w-7xl mx-auto">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">

          <!-- Articles -->
          <div class="lg:col-span-2">
            <div class="space-y-8">
              {blogPosts.map((post, index) => {
                const { title, description, pubDate, category, readTime, tags } = post.data;
                const slug = post.slug;

                return (
                  <ScrollReveal client:load delay={index * 0.1}>
                    <article class="glass rounded-2xl overflow-hidden hover:bg-white/10 transition-all duration-500 hover:scale-[1.02]">
                      <div class="p-8">
                        <!-- Category Badge -->
                        <div class="flex items-center space-x-3 mb-4">
                          <span class="px-3 py-1 bg-accent/20 border border-accent/30 rounded-full text-sm text-accent font-semibold">
                            {category}
                          </span>
                          <div class="flex items-center space-x-2 text-sm text-gray-400">
                            <Calendar size={16} />
                            <time datetime={pubDate.toISOString()}>
                              {pubDate.toLocaleDateString('fr-FR', {
                                year: 'numeric',
                                month: 'long',
                                day: 'numeric',
                              })}
                            </time>
                          </div>
                          <div class="flex items-center space-x-2 text-sm text-gray-400">
                            <Clock size={16} />
                            <span>{readTime}</span>
                          </div>
                        </div>

                        <!-- Title -->
                        <h2 class="text-2xl md:text-3xl font-heading font-bold text-white mb-4 hover:text-gradient transition-colors">
                          <a href={`/blog/${slug}`}>
                            {title}
                          </a>
                        </h2>

                        <!-- Description -->
                        <p class="text-gray-300 mb-6 leading-relaxed">
                          {description}
                        </p>

                        <!-- Tags -->
                        <div class="flex flex-wrap gap-2 mb-6">
                          {tags.map((tag) => (
                            <span class="px-3 py-1 bg-white/5 border border-white/10 rounded-full text-xs text-gray-400">
                              #{tag}
                            </span>
                          ))}
                        </div>

                        <!-- Read More -->
                        <a
                          href={`/blog/${slug}`}
                          class="inline-flex items-center space-x-2 text-accent hover:text-accent/80 font-semibold group"
                        >
                          <span>Lire l'article</span>
                          <ArrowRight size={20} className="group-hover:translate-x-1 transition-transform" />
                        </a>
                      </div>
                    </article>
                  </ScrollReveal>
                );
              })}
            </div>
          </div>

          <!-- Sidebar -->
          <div class="lg:col-span-1">
            <div class="sticky top-24 space-y-8">

              <!-- Categories -->
              <ScrollReveal client:load direction="right" delay={0.2}>
                <div class="glass rounded-2xl p-6">
                  <h3 class="text-xl font-heading font-bold text-white mb-4 flex items-center space-x-2">
                    <Tag size={20} className="text-accent" />
                    <span>Catégories</span>
                  </h3>
                  <ul class="space-y-3">
                    {categories.map((category) => {
                      const count = blogPosts.filter((post) => post.data.category === category).length;
                      return (
                        <li>
                          <a
                            href={`#${category}`}
                            class="flex items-center justify-between text-gray-300 hover:text-accent transition-colors"
                          >
                            <span>{category}</span>
                            <span class="px-2 py-1 bg-accent/20 rounded-full text-xs text-accent">
                              {count}
                            </span>
                          </a>
                        </li>
                      );
                    })}
                  </ul>
                </div>
              </ScrollReveal>

              <!-- Popular Posts -->
              <ScrollReveal client:load direction="right" delay={0.3}>
                <div class="glass rounded-2xl p-6">
                  <h3 class="text-xl font-heading font-bold text-white mb-4">
                    Articles Populaires
                  </h3>
                  <ul class="space-y-4">
                    {blogPosts.slice(0, 3).map((post) => (
                      <li>
                        <a
                          href={`/blog/${post.slug}`}
                          class="block text-gray-300 hover:text-accent transition-colors"
                        >
                          <p class="font-semibold mb-1">{post.data.title}</p>
                          <div class="flex items-center space-x-2 text-xs text-gray-500">
                            <Clock size={14} />
                            <span>{post.data.readTime}</span>
                          </div>
                        </a>
                      </li>
                    ))}
                  </ul>
                </div>
              </ScrollReveal>

              <!-- Newsletter CTA -->
              <ScrollReveal client:load direction="right" delay={0.4}>
                <div class="glass rounded-2xl p-6 bg-gradient-to-br from-accent/10 to-primary-500/10 border border-accent/20">
                  <h3 class="text-xl font-heading font-bold text-white mb-3">
                    Besoin d'Aide ?
                  </h3>
                  <p class="text-gray-300 mb-4 text-sm">
                    Discutons de votre projet et boostez votre visibilité en ligne
                  </p>
                  <a href="/contact" class="btn-primary w-full text-center text-sm">
                    Demander un devis gratuit
                  </a>
                </div>
              </ScrollReveal>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</Layout>
