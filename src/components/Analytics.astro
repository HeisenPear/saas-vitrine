---
// Analytics and Tracking Component
// This component is ready for Google Analytics 4, GTM, and other tracking tools
// Simply add your tracking IDs in the environment variables

const GA4_ID = import.meta.env.PUBLIC_GA4_ID;
const GTM_ID = import.meta.env.PUBLIC_GTM_ID;
const HOTJAR_ID = import.meta.env.PUBLIC_HOTJAR_ID;

// Only load in production to avoid tracking during development
const isProduction = import.meta.env.PROD;
---

{isProduction && (
  <>
    <!-- Google Analytics 4 -->
    {GA4_ID && (
      <>
        <script async src={`https://www.googletagmanager.com/gtag/js?id=${GA4_ID}`}></script>
        <script is:inline define:vars={{ GA4_ID }}>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', GA4_ID, {
            page_path: window.location.pathname,
            anonymize_ip: true,
            cookie_flags: 'SameSite=None;Secure'
          });
        </script>
      </>
    )}

    <!-- Google Tag Manager -->
    {GTM_ID && (
      <>
        <script is:inline define:vars={{ GTM_ID }}>
          (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
          new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
          j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
          'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
          })(window,document,'script','dataLayer',GTM_ID);
        </script>
      </>
    )}

    <!-- Hotjar Tracking -->
    {HOTJAR_ID && (
      <script is:inline define:vars={{ HOTJAR_ID }}>
        (function(h,o,t,j,a,r){
          h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
          h._hjSettings={hjid:HOTJAR_ID,hjsv:6};
          a=o.getElementsByTagName('head')[0];
          r=o.createElement('script');r.async=1;
          r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
          a.appendChild(r);
        })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
      </script>
    )}

    <!-- Custom Event Tracking Script -->
    <script is:inline>
      // Track CTA button clicks
      document.addEventListener('DOMContentLoaded', function() {
        // Track all CTA buttons
        const ctaButtons = document.querySelectorAll('[href="/contact"], .btn-primary');
        ctaButtons.forEach(button => {
          button.addEventListener('click', function() {
            if (typeof gtag !== 'undefined') {
              gtag('event', 'cta_click', {
                'event_category': 'engagement',
                'event_label': this.textContent.trim(),
                'value': 1
              });
            }
          });
        });

        // Track phone number clicks
        const phoneLinks = document.querySelectorAll('a[href^="tel:"]');
        phoneLinks.forEach(link => {
          link.addEventListener('click', function() {
            if (typeof gtag !== 'undefined') {
              gtag('event', 'phone_click', {
                'event_category': 'contact',
                'event_label': this.getAttribute('href'),
                'value': 1
              });
            }
          });
        });

        // Track email clicks
        const emailLinks = document.querySelectorAll('a[href^="mailto:"]');
        emailLinks.forEach(link => {
          link.addEventListener('click', function() {
            if (typeof gtag !== 'undefined') {
              gtag('event', 'email_click', {
                'event_category': 'contact',
                'event_label': this.getAttribute('href'),
                'value': 1
              });
            }
          });
        });

        // Track outbound links
        const outboundLinks = document.querySelectorAll('a[target="_blank"]');
        outboundLinks.forEach(link => {
          link.addEventListener('click', function() {
            if (typeof gtag !== 'undefined') {
              gtag('event', 'outbound_click', {
                'event_category': 'outbound',
                'event_label': this.href,
                'value': 1
              });
            }
          });
        });
      });
    </script>
  </>
)}

<!-- Development Mode Notice -->
{!isProduction && (
  <script is:inline>
    console.log('Analytics disabled in development mode');
  </script>
)}
